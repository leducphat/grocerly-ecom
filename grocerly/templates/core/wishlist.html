{% extends 'partials/base.html' %}
{% load static %}
{% block content %}
    <main class="main" id="wishlist-list">
        <div class="page-header breadcrumb-wrap">
            <div class="container">
                <div class="breadcrumb">
                    <a href="{% url 'core:index' %}" rel="nofollow"><i class="fi-rs-home mr-5"></i>Home</a>
                    <span></span> Wishlist
                </div>
            </div>
        </div>
        <div class="container mb-30 mt-50">
            <div class="row">
                <div class="col-xl-10 col-lg-12 m-auto">
                    <div class="mb-50">
                        <h1 class="heading-2 mb-10">Your Wishlist</h1>
                        <h6 class="text-body">There are <span class="text-brand" id="wishlist-item-count">{{ w|length }}</span> products in this list</h6>
                    </div>
                    <div class="table-responsive shopping-summery">
                        <table class="table table-wishlist">
                            <thead>
                                <tr class="main-heading">
                                    <th class="custome-checkbox start pl-30">
                                        <input class="form-check-input" type="checkbox" name="checkbox" id="exampleCheckbox11" value="" />
                                        <label class="form-check-label" for="exampleCheckbox11"></label>
                                    </th>
                                    <th scope="col" colspan="2">Product</th>
                                    <th scope="col">Price</th>
                                    <th scope="col">Stock Status</th>
                                    <th scope="col">Action</th>
                                    <th scope="col" class="end">Remove</th>
                                </tr>
                            </thead>
                            <tbody id="wishlist-body">
                                {% for item in w %}
                                <tr class="pt-30">
                                    <td class="custome-checkbox pl-30">
                                        <input class="form-check-input" type="checkbox" name="checkbox" id="exampleCheckbox{{ item.id }}" value="" />
                                        <label class="form-check-label" for="exampleCheckbox{{ item.id }}"></label>
                                    </td>
                                    <td class="image product-thumbnail pt-40"><img src="{{ item.product.image.url }}" alt="{{ item.product.title }}" /></td>
                                    <td class="product-des product-name">
                                        <h6><a class="product-name mb-10" href="{% url 'core:product-detail' item.product.p_id %}">{{ item.product.title|truncatechars:30 }}</a></h6>
                                    </td>
                                    <td class="price" data-title="Price">
                                        <span class="text-brand">$</span><span class="text-brand current-product-price-{{ item.product.id }}">{{ item.product.price }}</span>
                                    </td>
                                    <td class="text-center detail-info" data-title="Stock">
                                        <span class="stock-status in-stock mb-0">In Stock</span>
                                    </td>
                                    <td class="text-right" data-title="Cart">
                                        <input type="hidden" value="1" class="product-quantity-{{ item.product.id }}">
                                        <input type="hidden" class="product-pid-{{ item.product.id }}" value="{{ item.product.p_id }}">
                                        <input type="hidden" class="product-image-{{ item.product.id }}" value="{{ item.product.image.url }}">
                                        <input type="hidden" class="product-id-{{ item.product.id }}" value="{{ item.product.id }}">
                                        <input type="hidden" class="product-title-{{ item.product.id }}" value="{{ item.product.title }}">
                                        <button class="btn btn-sm add-to-cart-btn" data-index="{{ item.product.id }}">Add to cart</button>
                                    </td>
                                    <td class="action text-center" data-title="Remove">
                                        <button style="border: none; background: none;" data-wishlist-product="{{ item.id }}" class="text-body delete-wishlist-product"><i class="fi-rs-trash"></i></button>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="7"><p>Nothing in wishlist yet...</p></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        $(document).on("click", ".delete-wishlist-product", function(){
            let wishlist_id = $(this).attr("data-wishlist-product");
            let this_val = $(this);

            $.ajax({
                url: "{% url 'core:remove-from-wishlist' %}",
                data: { "id": wishlist_id },
                dataType: "json",
                success: function(response){
                    this_val.closest("tr").remove();
                    let count = $("#wishlist-body tr").length;
                    $("#wishlist-item-count").text(count);
                }
            });
        });
    </script>
{% endblock content %}
